---
layout: blog
banana: true
category: Redis
title:  Redis 如何分布式，来看京东金融的设计与实践
date:   2018-03-15 15:06:42
background-image: data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCAEsAfQDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD36iiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKQnFGcfSvOPGvxIXSJpNO0sJLcqMPKeVjPpjuamUlFXZ0YbC1cTNU6SuztdU17TdGgMt/dxwqP7x5P0FcXffGDSLditraXFx/tcKP1rxu/v7vUrprq9nkmmY5LO2fy9BVfr0xXJLEyv7p9fheGKSjevK7PX0+M9sW+fSZQvqJQT/Kui0j4leH9VKoZzbSk42TDHP16V4jY+GtZ1OPzbPTp5Y/7wGAfzqrfade6ZceTe20kEmM4cY/Kkq9RayWg6mSZdV9ylO0vU+p1dXAKkEHoQafXi/w/wDHlxaXUGk6lI0lvIQkcjHJQ9gfavZkYMoI6GuunUU43R8njsFUwdR06g6iiirOMKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigApDS0UAc1441qXQvC9zdwMBO2I4yexPevnRndixZizMckk9TXt/xdRm8LQkfdFwu78jXh1cOKb5kj73hWjD2EqnVsTrXdfDjwjHrt9Je3se6ztzhUPR39/YVy2i6Nd63qMVpaRlmdgGbHCDuTX0boWkQaHpEFjbrhI1wT3Y9yaMPS5ndlcQZmqNP2FJ+89/IuQW0UEKxxoFQDAAGMVl+IPDlh4gsHt7qMZ/hkH3lPqDW3mlI4rta6HwsKk4SU09T5XuYJdO1CW3dsSwSFSR6g9a+ivBuqtrHhaxvJP9YyFX/3lJB/lXhnjnZ/wmmpeXjiTnHrgV6l8JGY+EmBzgXD4/SuSh7tRo+szz99gKVeW/8AwD0Ciiiuw+OCiiigAooooAKKM4ooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA4/4lqjeCbwvj5SpH1yK8P0HRbnX9WisLYfM3LN2Ve5Net/F6+a38MxWyg/6ROAT24Gak+GXhk6TpIvrmPbdXXOCOVXsP61z1Ic80fTZfj/qWXzafvN6HSeG/Ddl4dsEt7aEB8fPIR8zn1JrbxRiiuhKysj52c5VJOc3dsSoL28isrKW5mYLHGpZmPYCp+leWfFPxWI4zoFqcu4DXDA/dHZf6/lSnJRjdm+Dw0sTWVKPU8s1C7bUNSubx/vTSs/PbJzXvfw6sG0/wbYq6kPIDKw/3iSP0xXiHh3Sn1nXbSyRSQ7gvx0UdTX0taxLBbpEgwqDAFc2Hi23Nn0XEdaMKcMNHoT0UUV1HyQUUUUAFFFFAHNXHiL7H42h0afiO5ty8TejDOR+IrpB0FeMfFS+ez8ZafcQNtlgiDA++7Neq6Fqker6Na30f3ZYw2PQ96zjO8nE7sRhHToU6y2kadFFFaHCFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQBXurG1vUCXNvFMqncBIgYA+vNSiIKABT6KEO/QQ8U0tih3CIWYgADJJrzHxn8SooIpLDRX8ydsq84+6g/2fU0pTUVdnRhcLUxM+Smrmv478cReH7M21owk1CUEKB0jH94/4V4ZPcT3t080zvLPI2WZjksaWRp7y6JZnmmkbvlix/rXrPgP4f8A2IpqerRZuesULdEHqfeuS8q0rLY+ypxw+S0G5a1Ga/w+8IrodgLy5jAvp1G7I5Rf7td0vApsY46U+uyKSVkfF4jETxFR1JvVhmjNFGaZjYM0ZozRkYoEBNN3gqeQcVy3ijxYumyJpWngT6vc4WGPqEz/ABN7DrU2o3y+GPCbz3E2+WKL7zdXc/4mloaxozk0rb7HjnxE1FdS8Z3jKcrDiEfh1/WvRvhHemfwvLbs2TbzlQPYgH+prxOeV5p5JZG3O7FmPqTya9U+DM2DqkJ9Y2/mP6Vw0Z3rN9z7PN8GqOVxh1jY9boooruPhwooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACq91dwWds89xIscSDLMxwAKg1bWLPRbCS8vZRHGnqeSfQe9eCeLPG194mnKFmisUOUgHf3b1NZ1Kqgj0suyyrjZ2jpHqzb8afEWbVvN0/S90NlyGl6NJ9PQVwccctzMkUSM8jkBVUck02JJLiVIokZ5HYKqgcknpXtngfwJBo0KX9+qyXxHGeiD2rjjGVaV3sfX154XJ6HLBe9+fqR+BfAH9j7NR1FUe8YAovURZ/rXoYwOtYmq+KtF0JMX19DG3aMNlj/wEc1xmo/GPT0Ypp9lNP/tOdo/xrsvCmrHyE6eMx9T2nK22enmkxXh118XdelOIIbWBf90sf51my/E7xU/S/WP/AHYV/qDUPEwOyHDuNkr2S+Z9B9KRpFUZZgB7185S+P8AxROMPrE3/AFVf5Csu513Vb3P2jUbuXv88rH9M1DxceiOmHC+JfxSSPojU/FmiaSha6v4VI/hDbmP0Arz7Xvi006G00K1l8xjtE0g/wDQVH9a8707R9Q1y6WGzgeaQ9Wxwv1PavUNG8L6H4KtRqmuXMb3a/d3HhT6KO5qo1Jz20Q6mX4PBfG+efRIt+CPDUulpNr+tSbtQnBZmkOTGvufXFcJ4+8Xv4iv1trckWNsx2c/6xv73+FO8XeP7zXZHtLQtb6cRjbjDSfX29q4ssM9KyrVtOWJ6eVZTN1PrOIVn0XYQ8GvUfgyD9u1JsdEQfqa8tPNev8AwagIstRuMfelVAfoM/1rPDr3zt4imlgZX8j1aiiivRPzcKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACqep6jb6Vp897cuEhhQsxNW815H8XvERJh0SB8A/vJwD1H8IP86ic+WNzrwWGlia8aS6nE+KfFd54n1JppXZLZTiGHPCj1+tc+CS3v9Kb0Na2iNa2c51G+TzI4f9VF/wA9JOw+g615rbnLU/S1ThgsPy047HfeE9M0rwppQ1zXXRbyRS0MLfeUdsD1NYfiL4javrDNFaObK07LGfmYe5/wrltV1a61i9e7u3LOx4XPCjsB6CqJJPc1rKtpyx2OChlCqT+sYr3pPp0QsjtI7M7FmJySxyTTRxRRXO9T2404xVooUEmk70UUWKtYt20Fq5BuLzyl77Yyx/z+NbtjeeE9OKvJY3moSj/noQiE/SuXzzRWkZ8vQ46+E9t8U3byO0uviFfmA2+l2dtpkPbyRlvz9fwrlru/u76TzLy4knk/vSMSaqZNFEpyluGHy/D0HeEde/UcTxTaWkqTtY4KCK9/+G2m/wBm+EbbcuJJyZm49en6AV4p4d0p9Z120sEGRI+X9lHJP5CvpW2hEMMcUa7URQoHoK68LD7R8bxTitI0F6lqiiius+MCiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigBpr5q8a3bXvjHU5WP3Z2jH0U4/pX0qeFNfL/AIiRk8T6sGGD9smP/j5rlxXwo+n4WiniZN9EZdOLE8E8CkoxXCfe2CiiigaCiiigAooopgFFFFAwooooEONAoro/DGhwXMjanqjiHS7Y7pGbgyEdFA71UY8zOfFYmOHpucvkdp8PdHj0PT1169GJrt1htkPUhiAPz6/SvWgPlFePaDrM3jDx5ZqiNHpun7pYoh0GBhSffn8K9gDYr0qduX3T81zR1ZV+er8T19B2KKM0ZrQ80KKM0ZoAKKM0ZoAKKM0ZoAKKM0ZoAKKM0ZoAKKM0ZoAKKM0ZoAKKM0ZoAKKM0ZoAKKM0ZoAKKM0UALRRRSEFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFACGvn/wCJmktp/i+eYIRFdASg44z0NfQNcd8Q/DJ8QaCxgUG7tv3kXH3vVfxFZVoc0bHq5PjPquKUns9GfPZGDiipJI3jkZHUqynBBHQ1HXmH6fGSkrrYKKKKBhRRRQAUUUUwCiiigAooooAepAIJGR6VYuby4ulRJJGZFGEjH3VHoBVYV6L8PfA8upXEerXyFbSMhokI5kPY/StKcZSdkefmOJoYak6tTfodd8M/DcmjaObq5iKXV1hiGHKr2Fd8BxzSRpsQADGO1P7V6UYqKsj8xxFeVeq6st2NoooqzIKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigB1FFFSSFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABTWGevSnUUAeaeO/h2upu+o6UoW7PLxcBZP8DXjdxaz2k7wXMLxSp95HGCK+rSobg1k6t4Z0jWkK31lHI2MB8YYfjXPVw6lqj6HLM+qYVKnUXNE+YsUV67q/wfhZ3fS714x/DHL8wH49a46/+HPiSxBP2Lz19YWzXLKhNdD6yhnmDrW96z8zk6Kv3Gi6natifT7qP6xNVJo3QkMjKfcYrNxkuh6McTRl8Ml942ijFPSKSQ4SNn/3QTSs+xbrU1vJDKK0rbw/rF4cQabdOf8ArkQPzNdJp/wu8RXm0yxRWyn/AJ6NyPwFXGnOWyOStmWFo/HNHFYqe0srm/nEFpBJPKeiRrk16/pHwk022ZZNQnlumH8A+VD+HU/nXeafoem6YgWys4oBjnYoBreOGb+I8PF8UUoK1CN33PNPCfwsJMd3rvBB3C2ByP8AgR716vbW6W8QijUKijCqowAKkVQDxTuldcYxirRPkMXja2LnzVWGKKKKs5BtFFFMoKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigB1FFFSSFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFGaACiiigAooooAKKKKACijNGaACkzS5pMigYUYHoKKKAEKKeqj8qYYIm6xqfwqTijIoC7RCLWAf8sU/75FPEEQ6RqPwp+RRkUrD5n3AKo7D8qMUZpaZLEopD1ozQFh1FJkUuaBhSUUUwEooxR0pjCikzS0AFFFFABRRRmgAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAHUUUVJIUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAVmazrljoNkby/l8uLO0cZJPoBWnXm/xj48OWX/X2v8A6A9TOXLG504Ogq9eNJ9WXf8AhbPhk/8ALaf/AL8tS/8AC2PDP/Pef/vy1eM6JoN54hvzZ2WzzAu7LHArph8J/EJ/itP++z/hXIq1WWsUfTV8oy2hLkqVbM9A/wCFseGf+e0//fhqVfiv4ZP/AC2uP+/LVwP/AAqXxD/etP8Av4f8K2dK+D8vmK+qXi7B1jhHX8TVKdd9Dkq4TKYRuqjZ3/h/xdpfiVpl09pGMOC++MrjP1rezxVDSdHsdIs1t7K3jhjXsoxn6+tTaheRafYT3UzbY4Y2dj6ADNdSvbU+fmoynamtCDVdasNFtTcX9wkMY6bjyT6D1rz6/wDjHbIXXT9NebB4eSTYD+ABrzXxDr114h1eW8uHYqWxEhOQi9hiup8M/DO81a1jvL6Q2tvIAyIPvsp6H2rkdac5WgfT0spwmEoqrjZavoXR8ZNR34Ok2+P+ux/wrc0n4vabcuI9QtHtCf4w29fzxn9Ke/wk0Yp8lzdB8ddwx+WK8+8WeCL7wyRMT59oxx5oH3T6Gm51o6sqjRyfFv2dO8Wz36zvoL+3S4tpFkicZV1OQasZr5/8AeKbjRNbgtJJW+w3LiNkJ4Uk8MB9ete+53L+Fb05qaujw8xy+eBrezlt09DldQ+JHh7Tb6WzmncyxNtfYhYA9xmqn/C1vDf/AD0m/wC/RrktW+FetXmr3t1FNa+XPcPKuWOQGYnnj3rh9c0WXQdRaxuJopJlUFvLOQM9qxqVakNbaHsYHLMvxKUVN81j2X/ha/hv/nrN/wB+jR/wtfw1/wA9Zv8Av0a8r0DwPqviS2e5tBGkKttDSEjcfatsfCPXcf661/76P+FQqtdq6RVTLsqpScJ1NUdz/wALX8M/89Z/+/Rq5pvxF0LVdQhsrZ5mmmOEBiNcJZfB/UHlH2y9hjQdRGCxNej+HfCGleHoQtrAGmxhpnGXb8a2puq/i0PNxtPLqUbUJOTN/dkZpNwIyOfpXI/ETxG3h3w+wtpNl3cHZER1Hqfyqt8MZ5bjwgjzSvI/mP8AM7En9a051zcpwLCy9h7fpexBc/FXTLPXZdNms7lfKmMTTcFcg4z1ziu9ilWWJZEOVYAg18zeJR/xVepf9fUn/oRr6O0j/kD2Z/6Yrn8qinUc20z0M0wFPDUqU4faRblmSFN8jqi+rHFVv7W07Gft0H/fwV418VNYuZ/Ep08SuttDGuEUkBieckd65K00jVdQhMtnZ3M8ecbkQkZpSrtOyR04TIVVoKtUqKNz6R/tjTj/AMvtv/38FH9saf8A8/tv/wB/BXzt/wAIvr5/5hd5/wB8Gg+Ftf8A+gVef98Gj28v5Tb+wMP/AM/0d94z+Iup6R4ge00x7V7dUU7tu7JPvmuq8HeME1vQ1ub+WCC4VyjDeBnHfmvFG8K68f8AmFXf/fs0n/CL6+BgaVeD6Rmso1aik3bQ7KmT4KVGMI1EpLr3Pov+19P/AOf63/7+Cj+17D/n9g/7+CvnUeGPEH/QLvP++DS/8Iv4g/6Bd5/37NX7eX8pyf2Dh/8An+j6Nj1KzlYLHdQu3YBwSashs9K+WJoruwuSkgmt7iM8jlWX+tfQngTUZ9T8JWU9y5ebbtZj1bBxmrpVud2aPPzPKPqUI1FPmTOloooroPHCiiigAooooAKKKKACiiigAooooAKKKKACiiigB1FFFSSFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFebfGT/kXLL/r7H/oD16TXmvxiJ/4R2z/AOvsf+gPWdX4GejlP++0/U5P4Tf8jU3/AFxb+de6Yr5q8L+I38Mak19HbidjGUClsAe9dDP8WvEEjkxJaxD0CZ/ma56NWMIanvZvlOKxOLcqa0PdSBQK8Rsvi1rcTKbiC2nXuApU/hXofhrx3pfiECJXNvd45hk7/Q963hWjPRM8LFZTisMuapHTujrK5b4hu6+CNSKDkoAcehIB/TNdODVPVrCPVNLurKb7k0TIfbIxVyV00cVCahVjJ9GfMmnxrNqVrG/3XmVW+hNfUVuix28aKAFVQBj6V8z6ppl1omqyWs6lJoXyG7EdiK9s8I+N9O1iwhhmuEhvUUK8bnG4gdR7Vy4X3bp7n1PEMJV4U61PWPkdhWH4utI7vwvqKSgY8liM+wrWa7t1j3tNGF9SwrzP4i+O7X+zZNJ0uUSyTDbLIpyqL6A+tdVSSUW2fPYLD1ateKpp3ueUWrH7RCR94OpH1zX1NbndAhPXAr538EeH59e16DCEWsDh5n7YBzt/GvolAFQDsK58Kmou57fE1aE6sIxeqWpj+Kteh8O6NLeyEF8bYk/vMa8AtYL7xPryoD5lzdSZZj0Hqfwrf+JXiF9X8QyWSEi3sWaMD1YfeP5jFM8EeJNI8NPNcXdvcTXT/KGjVSFX05IqaklOpyt6HVl2EnhME8RCN5y29D27RdMt9I0yCygUBIkCjjr71fJABAPNedL8XtGA/wCPK+z/ALqf/FUh+MOijj7Dff8AfKf/ABVdPtIbJnz88sxspNuDLI+Jtpa6tPp2q2ctpJFIV353Ljsa7ezuoby3SeCRXikG5WU5BFeC+OfEeleJbmG9sra5huEXbIZFUBh26E8jmrnw68W3Gm6tBpUpZ7K4fYoJz5bHpj2zWca3v8rO6rksnhfbxVmt0yz8Y7l38RWVuc7I7fcPqWI/9lFdj8K/+RLT/ro1cR8XefFVvzx9kX/0N67j4WceC0/66PUx/jM1xMUspp27njviX/ka9T/6+3/9Cr6P0j/kDWf/AFxX+Qr5w8Sf8jXqn/X3J/6Ea+j9I/5A9n/1xT+Qp0PikXn3+70PQ5LWfhxY634jfVby6mCMADCmFBx79amufF3hbwrEmnxzofLGPKgG7b9cVqeLdH1PW9L+x6bfrZ7z+9YqSWX0BHSvNj8G9SL5/tS3/wC/R/xq5c0fhR52EdKuksVUtFdDpx8WfD4PEV0f+2dKPi14fx/qbn/v3XNf8Kd1FV51S2/79n/Gub17wpDoAKy6zbzT9oYkJb8eeKzdWrFXaPUo4HK60lGE22ekH4taBn/VXH/fumj4u+H84ENx/wB+68TOc4wc12WhfDXV9atFuXkjs425QSqSzD1wOlTGvUk7JHXicly/DRUqsmjvP+Ft6B/zxuP+/dJ/wtzQOvk3P/fuua/4U5qX/QUtz/2zP+NTW/wenEg+1aonl9/LTB/WtOer2OB4fJ7fxGP1TVPCvjrUba2jhvY76Vgiyxx8jP8Ae9hXo/hrRV0DR4dPWUyiPPzkYzzWb4a8H6V4by1qheduGlc5b/61dTmtYx6vc8fF107U6bfItri0UZpK0OIWijj0o49KACijj0o49KACijj0o49KACijj0o49KACijj0o49KACijj0o49KACijj0ooAdRRRUkhRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABXH/EDw1eeJtJtbWyZBJHcB2LnAC7WB/mK7CkNJpNWZpRqypTU4bo8y074R6dAiHUJ5rh/4lU7V/Tn9a2x8M/C+zH9nH6+a/wDjXY0VKpxStY66mZYubu6j+88s1z4S2/lNLo87ROBkRSncp9s9RXmE8N3pd+Y5FkguYG9wVI7ivqEgEYNeY/FjRIv7Ph1eNP3kbCNyO6npn6VlVpK3NHQ9jKc3qSqLD13zKWmps/D/AMWt4g08wXbg31vjf2LL2bFdqSAuTXgHw5vfsnjK12nAmVoiPXIz/MCvW/GuvtoHhme4iP8ApDjy4vZj3/DrV0qnNC7OHNMv9jjPZU/tbHOfEHWfC6KbW9gW7vlB2rEcNH9WHT6V48qNLLiFHLZ+UKCSB+FSWtvc6vqkcCsZbi4kxubqSe5r6E8OeFNO0Gwjiht0abaN8pX5mPfmsNazutD2pVqeT0lTfvyl06I+fpbHWFjy1vfeX7o+P5VBaNBFdo13C0kSt+8jB2k+1fUoiTGNo/KuJ8deCLbWdPku7SFYr+JcqVGN49DTlQdrpmWF4gg5clSCinpdFrwTqmgXmlJDo6xwbPvwfxg+p9frXXKMivmDStRuNF1eC8hZlkhkBIHGRnkH2r6X0y8jv9PguojmOZA6n2IzW1GfMjy85y94SrzJ3jLZnn3if4XLqusS39jdLbmdi8qMpILHuPSsb/hT2oY/5CEP/fJrtPEHxE0jQNSewnjmlmjALiMcLmssfGDRD/y53f5L/jUyVFvU2w+IzVUkqSfL00PO/Ffg648KR2z3E6SidioCA8Y+tHhXwZP4qS4eC5jh8kgHcCc5rQ+IHjKx8UwWaWcM0fksxPmAdx7UeAfGNh4Xhu1vIpnMrKV8sA9jXNy0/a26Hv8Atcf/AGfzNP2lzTHwf1AqR/aUH/fBrY8M/C5dI1WK/vrkXBhO6NEXAz6mpv8AhcGhjpaXf/fI/wAa1vD/AI/sfEmofY7OzugQCWdlG1fqQa6owp30PAxWKzT2bVa6izz74tj/AIqq3/69F/8AQ3ruPhb/AMiYv/XR/wCdcN8XOfFcH/Xov/oT13Pwr/5Etf8Aro/86zh/GZvi/wDkVUvU8d8Sf8jXqn/X3J/6Ea+j9I/5A9n/ANcU/kK+cPEv/I16p/19yf8AoRr6P0j/AJA9n/1xX+QqqHxSHn3+74f0IdS8RaPo5K3+oW8DgZKO43Y+nWuL1f4t6VbZXToJbtuzY2r+vNdL4i8G6T4kO+8hxOBgTIcMPx71y6fB7SUky99dMn904H64rWfP9k8rBLArXEN38jhdU+IfiPWpjHHObeJuBDbjk/j1NWdC+H+q6q63OohrO1+8zy8Ow+hrvfN8GeBkKL5QugOg+eQ/4V594l8f6h4hZ7S1U21k52+Why8n1P8AQVg0lrN3fY92hVnVXJg6fJH+ZmB4gsLTTtant7G6FxAp+Vwc49s969s+HmuDWPDEXnMDPbHyn9TjofyryG48IarZ6FJqt3D5ESkBUb7xB747VV03xBqOkWN1a2UpiFxgOw+8B7elZQn7Kd31O7GYRZhhlClLmlHqeveL/iLZ6GHtNPaO5vuh2nKxn3Pr7V5Z/a/ivxLdeVHdXt05OdkXCge4GABUHhrSItf12KyubnyFkOS2Mlj3A96+gtI0ex0ezS3srdY0HoOT9T3raPPVd9keVX+r5UlTjHnn3ex5/wCFfAet2t1FdX2r3FvhgxhhkJ3c9GJ4r1NVwKAo64xTq6FHl0R89Xryrz55DTxRQ1FWZBRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQA+iiipICiiigAooooAKKKKACiiigAooooAKKKKACkPSlNef+L/ABZqvhLXIJ3gFzpNwNu3bgo464P05waTaSuzSlSlVlyx3O+orktL+Ivh3UlXN6tvIw+5P8uPx6VuprmlSJuTUbVhjORKtCkuhc6FaDtKLRoV598WdQit/DKWZb97cSgKPYcmtTWviDoOkRti7S5mxxHCwbJ+vQV4p4l8RXniTVWvLohUHyxRjoi+n1rKtUSjbqz18ny2rVrxqSVorW7NDwDbSXPjKwCD/VkyN7AA/wD1q7n4wlv7GsAM7fOOfyp3ww8LSafC2r3iMs06bY0b+FOD+tbvxB0Vta8LTpEN00P75AO+Oo/LNTCm1Sa7nTjMdTnmkZr4Y2R5N8PDH/wmtiX6ZbGfXBxX0Op4r5XsbufT76G8tmxLCwZSR6V9AeF/Gum6/aRhZkju9o3wMcEHvj1FRhpq1uppxJhqk6ka8VeLR1VMlwIXz0waPNQLneuPXNcD46+IFtpllLYadKk99IpUlWyIx6nHeulySV2fOYfDVK9RQprU8b1RkbWL4x42ee5XHpuNfQXgTefBmm7+vl1872ltLfX0NtGC0s8gQeuScV9PaPZJp2lW9mnKwxhQfoKxobtn0/Ek4xo0qPVHD+JPhi2va7cakuoGMTEHYUzjAA/pWV/wpp/+gp/5Dr0fUfEOk6VMIr6+ggkYZCu3OKp/8Jv4cH/MXtv++6uVKm3dnkUMyzCEFGm3ZeR414z8FnwnDbSG788zsR93GMUeDPBTeLI7lxd/ZxCQPu5znP8AhW58V9d03WLbTV0+7jnMbuW2HOOAKd8Ktc03R7a+F/dxwb2XbvPXrXNyQ9ry9D6BYzGPLXV1579jVs/g3aRyBrvUZZU/uooWu90nQ7HRLVbext0iQeg5PuT3qn/wnHhw/wDMWt/++qkg8X6DdXEcEOp27yyHaqh+Sa64QhHY+YxNfG11++u0eT/Fv/ka4f8Ar1X/ANCeu6+FnHgxf+uj1b8SeA9M8Takl7eTXEbrGI8RMACASe4Pqaet94d8EaOtl9sjjRQcI0gZyT3x1rNQaqOb2Ouri41sFTw1NNyR4f4kOfFWp/8AX2//AKEa+j9I/wCQNZ/9cU/kK+Z9Ruhf61c3SKQs87OoPuc19NaYhj0y2jPVY1H6VNB3lJnbxAuWjQi90jlfGPjLU/Dc2y30WS4hKgi43fLn046V5lq/xC8R6vlPNa0j6bIFIJ/HrXvN3JbRRlrmSNE7lyAP1rkdQ8X+ENMclpbaWUcgQoHOfqK0nFv7VjzsvrQhtR52eU6N4J1zX5PMS3McLHLTz8fz5Nd/a+HfDXgO1/tHU5/tF4gyu4ZJPoq1ja18VryUGLRrSO3jP/LSQbmP0HQfrXHWtnrXizUztEt1O5+aRydqj3PYVjeMH7urPdlTxWIXNiX7On2RreKfG114mIhRTb2SHIhB5b3aovA2lW2r+KIre7iEsQjZ9h6EjGP51p+I/B9p4T8NpLPKZ7+4kCA/wp3OB+HWrXwlsjP4hnuuQIYSv/fR/wDrVHLJ1Fzm8q+Hhl03htIrr3ZzXiTS7rwr4pYQsU2SCa3cemf8eK9v8K+I7bxHo8d3DhZB8ssefuN6VS8ceFY/EOkOY1/02EFoWHf2P1rx3wx4ivPCesGQKTGx2XEB4yO/0IrVfup2ezPKaWaYXmX8SH4n0fmisrRtdsdcsUurKYOhHIzyp9CO1aYPFdSt0Pm5QlF2krMVqKTNGaYC0UmaM0ALRSZozQAtFJmjNAC0UmaM0ALRSZozQAtFJmjNAC0UmaKAJKKKKkgKKKKACiiigAooooAKKKKACiiigAooooAKo6lplrqtk9pdwrJE4wVYVeooGm07o8P174TanaSPLpTpdQZyI2O1wPT0NcrL4T1+CQq+k3WR6RkivprHtSbQewrnlh4s93D8Q4mlHlklL1Pmy08F+Ib6QJHpk6k/xSjaB9c16L4X+F8WnSx3erslxOpDCJfuKff1r03aPQUEVUKEIO5ni89xOIjy/CvIYiKq4AwPSlZFIxjrTuKK3PGep5f4x+GX26eTUNGKRzMdzwNwrH1B7GvNrnwvrtjIfN0y6Ur/ABKhI/MV9M8UmAeoFc88PGTutD2sJnmIoQ9m/eXmfMZstZPym3vSP7pVqu6f4M17UHCw6fKi/wB6UbV/Wvo4xr1wBShQB0FSsKurOqXElVL93TSZw/gvwFbaABc3O2e+I5fHCewrt8bVwBTgB2orpUUlZHg169SvNzm7s8T8c+Fdd1LxbeXVrYSywPt2OCMEYFc4fA/iQf8AMKm/T/Gvo/juKMD0FYToRk7tnq4fPq9CmqcYqyPm8eBvEf8A0Cp/0/xpR4G8SAYGlzYP0/xr6Q2j0oxU/VY9zpXFGJ/lR882Xw58SXcgDWYt17tM2P5Zr03wj8PbHw+Vu7hvtN8B98j5VP8Asiu54xRx6VpCjGOp5+LzjEYpcstF5Hlnjd/GGp3ktjptjNFYIcB43w0nvn09q4I+BPEjNk6VOWPckfzzX0hgegoxx0FOdJT3ZWFzephYctOKPHfB3wzu0vor/WQsaRsGSDOSSPXtivYFUBQB2FOwMUlVCCgrI48ZjauLnz1Wch4u8CWXiaX7Q0kkF0FCiReQfqK4WX4O6iJMJqVuU9ShBr2n8KOPSiUIyeqNMNmOIw65ab0PNdG+FGn2bLJfzNdsOduNq/lXoFpYWtnbiG3gjijXoqLgCrJxR7VSilsZYjF1sQ71JXPGvihHqura9FbWun3L21qnDIhIZj1/kK6z4Y6FcaPoLyXcLRXFxIWKMMEL0Ga7jAz0p46VHs0p85vUzCcsKsKlaKE+tcf4q8A6b4iHnIPs15/z2Qfe/wB4d67E0lU0pKzOOlWnRlz03ZnjVp8OvFeh3wuNKv7bcD94SMu4e4xivVNI/tAaZCNU8n7YF/eeSSVz7ZrSwKaRRCKjsa4jF1MS71NxBRS0lWYBRRRTAKKKKACiiigAooooAKKKKACiiigAooooAkoooqCAooooAKKKKACiiigAooooAKKKKACiiigApM0tULqxuZ5i8Woz264xsRVI+vINAF+isv8Asu9/6DV3/wB8J/8AE0f2Xe/9Bq7/AO+E/wDiaANSgjNZf9l3v/Qau/8AvhP/AImkOl3v/Qau/wDvhP8A4mgDTrB1XVby11iwtIYMW8soWSZuhzn5R+VbFtC8MASSd5mHWR8ZP5Vj6/h73S0BG5JzMw6YRVOT+GRTGZp8Q6nPLYNCbSMTCQFJWKiQg4ABwcdPxzWlpOsajfanc201rbLFbNskkilLfN6DIH41iNZz3mm2Wk+daC1udzxzbSzvyWOwEcEA9TWh4eim0y/udLhkS4tIyWaQ8SIxwcNx82c9aYHR3bvHayPG0auqkgyZ2j3OK5M+KbqSI7Lywwy8OsMp/EV1d1te0lV1BRkKkE4zkdM1xcVvfQQrHFb36RoAqr/akPAFICePxPexQqr31g+0cu0Eoz7ntXW2jSvaxvO0bSMMkx52n6Zrg5bqR7xNOnXUC0ww6f2gjAKepbA4Fd9bhBCqxkeWoAXByMUAZut6ldWE9j5FvLLC8h88xx7iFA/qazG8USDxAsQs77yPsxYxeT8xbd1x6Yrb1KfUYSn2CziuM/e3ybMVzZutbPixH/s6AT/Y8eX5/G3f1zj1oA6Ow1gX85iFndw4Xdumi2j6fWr8hIjbb1xxVDT59Smkf7fZwwKANhjl35P5VfkG5GX1GKBWMi2bVJ9ItzLcRWl4c+YZIt/rxjI9qz7WfWLnU720bV4YxblcOtsPn3DPc1Vn+ww2dnpv2VNWvYpGhUMdgBxubk+2KqQaJcQXV1PL4Yt2ifaUjFwuEAHNAzuLYt9nQSSiVwMM4GMn1xVfUNRlsTGI9PubvfnPkAHb9ckUzRTbvpFvJaxCGF13LGP4c1onpQBzba3qh1GOQaLfC0EZDoUTcWzwev1q5pevpql1PbpY3UJg4kaUKAD6cE81HrOozecmlaew+3Tjl8cQJ3Y+/pWjYWMOn2iwQg4HLMTy7dyT3JoAsOxCEqu5gOBnrXLtretpeSSnS4jb7APLN2mQwzk5x9OPaukuWZLaVkZVYKSGYZAOO4Fec3D2BjllefQycFifsb5NAG2PEmsX6Wl1aadElqSXcNdJlxjgcjiuptZZJraOSWLypGUFk3btp9M968z00WB023Uz6OXVRu86zZnB9yO9ejaU5k0y3dnjclc7olKqfoD0pjLnenZqhc2VzPOXi1GeBcfcRVI/UGov7Nvf+gxdf98J/wDE0AatJWX/AGbe/wDQZuv++E/+Jo/s29/6DF1/3wn/AMTSCxq5pvasz+zbz/oMXX/fCf8AxNXreN4oVR5mlYdXcDJ/KmFiWkpaSgYUUUUwCiiigAooooAKKKKACiiigAooooAKKKKAJKKKKggKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigApDS0HpQA2subTpbjVJZ5GXyvsxiix1BY/Mf5VqUUxnJ2+n61aRWUR0+ynayBWGU3DLwRgnGPStKCxuU1tdQIRVmtgk6A5+ccjH5mto0UARyQxzwmOWNXRhgqwyDWJqWjKvl/2dpOnyE53+cMY9MY/Gt+igDC0rw3Z29giXllavcFmZyEyASxOBnsMgfhW3DDHbxLFCipGowqqMAU6igZnX82qxzqLG1t5o8cmWUqc/lWM1v4ibWl1H7JZZEHk+X55xjOc5xXVUUwMuyn1h7kLeWltFDg/NHKWOfpirt8LhrGcWpUXBQiMv03Y4zU9FIDl30K7srXTHsBHNc2jtJIJW2iUsMMc465qw9z4kdGX+yrMZGM/aj/8AE10AopgUdIs3sNJt7WRgzxoAxHrUeoNrHmgaetmY9vzGfdnPtitKigDlbCw8RWBmf/iWzTzOXklffubPb6DoBWpZtrhuVF4lgIO/k79361rUUAQ3JlFtIYFVpQp2BzgE9s1hf2NfanMj6xND5CEFbS2UhWP+0Tyfp0ro6KAMK88OwyT/AGuwkayu+7Rj5X9mXoa07IXH2SP7WIxOB83l52/hmrNFAwooooAKKKKACiiigApKWkoAKKKKYBRRRQAUUUUAFFFFABRRRQAUUUUAFFFFAElFFFQQFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUHpRQelADaKKKYwooooAKKKKACiiigAooopjCiiigAooooAKKKKACiiigAooooASiiigYUUUUAFFFFABRRRQAUlLSUAFFFFMAooooAKKKKACiiigAooooAKKKKACiiigD/9k=
tags:
- mysql
- 架构之路
- Nosql
- road
---


## 58到家数据库30条军规解读
原创 2017-02-15 58沈剑 架构师之路

军规适用场景：并发量大、数据量大的互联网业务

军规：介绍内容

解读：讲解原因，解读比军规更重要

 

一、基础规范

（1）必须使用InnoDB存储引擎

解读：支持事务、行级锁、并发性能更好、CPU及内存缓存页优化使得资源利用率更高

 

（2）必须使用UTF8字符集

解读：万国码，无需转码，无乱码风险，节省空间

 

（3）数据表、数据字段必须加入中文注释

解读：N年后谁tm知道这个r1,r2,r3字段是干嘛的

 

（4）禁止使用存储过程、视图、触发器、Event

解读：高并发大数据的互联网业务，架构设计思路是“解放数据库CPU，将计算转移到服务层”，并发量大的情况下，这些功能很可能将数据库拖死，业务逻辑放到服务层具备更好的扩展性，能够轻易实现“增机器就加性能”。数据库擅长存储与索引，CPU计算还是上移吧

 

（5）禁止存储大文件或者大照片

解读：为何要让数据库做它不擅长的事情？大文件和照片存储在文件系统，数据库里存URI多好

 

二、命名规范

（6）只允许使用内网域名，而不是ip连接数据库

 

（7）线上环境、开发环境、测试环境数据库内网域名遵循命名规范

业务名称：xxx

线上环境：dj.xxx.db

开发环境：dj.xxx.rdb

测试环境：dj.xxx.tdb

从库在名称后加-s标识，备库在名称后加-ss标识

线上从库：dj.xxx-s.db

线上备库：dj.xxx-sss.db

 

（8）库名、表名、字段名：小写，下划线风格，不超过32个字符，必须见名知意，禁止拼音英文混用

 

（9）表名t_xxx，非唯一索引名idx_xxx，唯一索引名uniq_xxx

 

三、表设计规范

（10）单实例表数目必须小于500

 

（11）单表列数目必须小于30

 

（12）表必须有主键，例如自增主键

解读：

a）主键递增，数据行写入可以提高插入性能，可以避免page分裂，减少表碎片提升空间和内存的使用

b）主键要选择较短的数据类型， Innodb引擎普通索引都会保存主键的值，较短的数据类型可以有效的减少索引的磁盘空间，提高索引的缓存效率

c） 无主键的表删除，在row模式的主从架构，会导致备库夯住

 

（13）禁止使用外键，如果有外键完整性约束，需要应用程序控制

解读：外键会导致表与表之间耦合，update与delete操作都会涉及相关联的表，十分影响sql 的性能，甚至会造成死锁。高并发情况下容易造成数据库性能，大数据高并发业务场景数据库使用以性能优先

 

四、字段设计规范

（14）必须把字段定义为NOT NULL并且提供默认值

解读：

a）null的列使索引/索引统计/值比较都更加复杂，对MySQL来说更难优化

b）null 这种类型MySQL内部需要进行特殊处理，增加数据库处理记录的复杂性；同等条件下，表中有较多空字段的时候，数据库的处理性能会降低很多

c）null值需要更多的存储空，无论是表还是索引中每行中的null的列都需要额外的空间来标识

d）对null 的处理时候，只能采用is null或is not null，而不能采用=、in、<、<>、!=、not in这些操作符号。如：where name!=’shenjian’，如果存在name为null值的记录，查询结果就不会包含name为null值的记录

 

（15）禁止使用TEXT、BLOB类型

解读：会浪费更多的磁盘和内存空间，非必要的大量的大字段查询会淘汰掉热数据，导致内存命中率急剧降低，影响数据库性能

 

（16）禁止使用小数存储货币

解读：使用整数吧，小数容易导致钱对不上

 

（17）必须使用varchar(20)存储手机号

解读：

a）涉及到区号或者国家代号，可能出现+-()

b）手机号会去做数学运算么？

c）varchar可以支持模糊查询，例如：like“138%”

 

（18）禁止使用ENUM，可使用TINYINT代替

解读：

a）增加新的ENUM值要做DDL操作

b）ENUM的内部实际存储就是整数，你以为自己定义的是字符串？

 

五、索引设计规范

（19）单表索引建议控制在5个以内

 

（20）单索引字段数不允许超过5个

解读：字段超过5个时，实际已经起不到有效过滤数据的作用了

 

（21）禁止在更新十分频繁、区分度不高的属性上建立索引

解读：

a）更新会变更B+树，更新频繁的字段建立索引会大大降低数据库性能

b）“性别”这种区分度不大的属性，建立索引是没有什么意义的，不能有效过滤数据，性能与全表扫描类似

 

（22）建立组合索引，必须把区分度高的字段放在前面

解读：能够更加有效的过滤数据

 

六、SQL使用规范

（23）禁止使用SELECT *，只获取必要的字段，需要显示说明列属性

解读：

a）读取不需要的列会增加CPU、IO、NET消耗

b）不能有效的利用覆盖索引

c）使用SELECT *容易在增加或者删除字段后出现程序BUG

 

（24）禁止使用INSERT INTO t_xxx VALUES(xxx)，必须显示指定插入的列属性

解读：容易在增加或者删除字段后出现程序BUG

 

（25）禁止使用属性隐式转换

解读：SELECT uid FROM t_user WHERE phone=13812345678 会导致全表扫描，而不能命中phone索引，猜猜为什么？（这个线上问题不止出现过一次）

 

（26）禁止在WHERE条件的属性上使用函数或者表达式

解读：SELECT uid FROM t_user WHERE from_unixtime(day)>='2017-02-15' 会导致全表扫描

正确的写法是：SELECT uid FROM t_user WHERE day>= unix_timestamp('2017-02-15 00:00:00')

 

（27）禁止负向查询，以及%开头的模糊查询

解读：

a）负向查询条件：NOT、!=、<>、!<、!>、NOT IN、NOT LIKE等，会导致全表扫描

b）%开头的模糊查询，会导致全表扫描

 

（28）禁止大表使用JOIN查询，禁止大表使用子查询

解读：会产生临时表，消耗较多内存与CPU，极大影响数据库性能

 

（29）禁止使用OR条件，必须改为IN查询

解读：旧版本Mysql的OR查询是不能命中索引的，即使能命中索引，为何要让数据库耗费更多的CPU帮助实施查询优化呢？

 

（30）应用程序必须捕获SQL异常，并有相应处理


总结：大数据量高并发的互联网业务，极大影响数据库性能的都不让用，不让用哟。

==【完】==

自转到58到家，负责过较长一段时间DBA部门，搭建团队，讨论流程，讨论规范，讨论自动化，尝试平台化，故希望沉淀一些东西。